<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <title>äº”é‚Šå½¢ç´…è—å°æ±º (5ç›¤3å‹)</title>
  <style>
    :root {
      --bg-color: #2c3e50;
      --board-bg: #34495e;
      --red-color: #ff1744;
      --blue-color: #2979ff;
      --text-color: #ecf0f1;
      --accent-color: #f1c40f;
      --node-size: 56px;
      --line-width: 4px;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }
    #gameInfo {
      display: flex;
      gap: 30px;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    #board {
      position: relative;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, #1a252f 0%, var(--board-bg) 70%);
      border-radius: 20px;
      border: 3px solid var(--accent-color);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .node {
      position: absolute;
      width: var(--node-size);
      height: var(--node-size);
      border-radius: 50%;
      border: 4px solid #ffffff;
      cursor: pointer;
      transition: all 0.22s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
    }
    .node:hover {
      transform: scale(1.1);
      box-shadow: 0 0 18px rgba(255,255,255,0.9);
    }
    .node.selected {
      box-shadow: 0 0 26px var(--accent-color);
      transform: scale(1.2);
    }
    .node.red {
      background: radial-gradient(circle, var(--red-color), #c62828);
      box-shadow: 0 0 16px rgba(255,23,68,0.9);
    }
    .node.blue {
      background: radial-gradient(circle, var(--blue-color), #1565c0);
      box-shadow: 0 0 16px rgba(41,121,255,0.9);
    }
    .node.red span,
    .node.blue span {
      color: #fff;
      text-shadow: 0 0 4px rgba(0,0,0,0.8);
    }
    .node.empty {
      background: rgba(255,255,255,0.10);
    }
    .node.empty span {
      color: transparent;
    }

    .line {
      position: absolute;
      background: rgba(255,255,255,0.45);
      height: var(--line-width);
      border-radius: 2px;
      transform-origin: left center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .btn {
      background: linear-gradient(145deg, var(--accent-color), #f39c12);
      color: #000;
      border: none;
      padding: 10px 24px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 25px;
      cursor: pointer;
      margin: 8px;
      transition: all 0.22s;
      box-shadow: 0 4px 15px rgba(241,196,15,0.4);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 22px rgba(241,196,15,0.6); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; }

    #message {
      margin: 16px 0;
      font-size: 18px;
      text-align: center;
      padding: 10px 18px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
    }
    .win-msg { color: var(--accent-color); font-size: 22px; }
  </style>
</head>
<body>
  <div id="gameInfo">
    <div>ğŸ”´ ç´…æ–¹: <span id="redScore">0</span> / 3</div>
    <div>ğŸ”µ è—æ–¹: <span id="blueScore">0</span> / 3</div>
    <div>ğŸ“Š ç¬¬ <span id="currentGame">1</span> ç›¤</div>
    <div>ğŸ‘¤ <span id="currentTurn">æœªé–‹å§‹</span></div>
  </div>

  <div id="board"></div>

  <div>
    <button id="resetBtn" class="btn">ğŸ”„ é‡æ–°æœ¬ç›¤</button>
    <button id="newSeriesBtn" class="btn">ğŸ† æ–°ç³»åˆ—</button>
  </div>

  <div>
    <button id="startRedBtn" class="btn">ğŸ”´ ç´…æ–¹å…ˆæ‰‹</button>
    <button id="startBlueBtn" class="btn">ğŸ”µ è—æ–¹å…ˆæ‰‹</button>
  </div>

  <div id="message">è«‹å…ˆæ€ã€Œç´…æ–¹å…ˆæ‰‹ã€æˆ–ã€Œè—æ–¹å…ˆæ‰‹ã€ï¼Œå†é–‹å§‹è¡Œæ£‹ã€‚</div>

  <script>
    // äº”é‚Šå½¢ï¼šå¤–åœˆ 1-5ï¼Œ0 ç‚ºä¸­å¿ƒï¼Œåªé€£ 1ã€3ã€4
    const edges = {
      0: [1, 3, 4],
      1: [0, 2, 5],
      2: [1, 3],
      3: [0, 2, 4],
      4: [0, 3, 5],
      5: [1, 4]
    };

    // äº”é‚Šå½¢ä½ç½® (500x500)
    const positions = {
      0: { x: 250, y: 250 },  // ä¸­å¿ƒ
      1: { x: 250, y: 90 },   // ä¸Š
      2: { x: 380, y: 190 },  // å³ä¸Š
      3: { x: 340, y: 360 },  // å³ä¸‹
      4: { x: 160, y: 360 },  // å·¦ä¸‹
      5: { x: 120, y: 190 }   // å·¦ä¸Š
    };

    let pieces = {};
    let currentPlayer = null;     // ç”±æŒ‰éˆ•æ±ºå®šå…ˆæ‰‹
    let selectedNode = null;
    let redScore = 0;
    let blueScore = 0;
    let gameNumber = 1;

    const board         = document.getElementById('board');
    const message       = document.getElementById('message');
    const redScoreEl    = document.getElementById('redScore');
    const blueScoreEl   = document.getElementById('blueScore');
    const currentGameEl = document.getElementById('currentGame');
    const currentTurnEl = document.getElementById('currentTurn');

    function initBoard() {
      // ç´…åœ¨ 2ï¼Œè—åœ¨ 5
      pieces = { 0:null, 1:null, 2:'R', 3:null, 4:null, 5:'B' };
      selectedNode = null;
      currentPlayer = null;  // æœªæ€å…ˆæ‰‹
      renderBoard();
      updateUI();
      setMessage('æœ¬ç›¤å·²é‡è¨­ï¼Œè«‹æ€ã€Œç´…æ–¹å…ˆæ‰‹ã€æˆ–ã€Œè—æ–¹å…ˆæ‰‹ã€ã€‚');
    }

    function renderBoard() {
      board.innerHTML = '';

      // ç·š
      Object.entries(edges).forEach(([from, tos]) => {
        tos.forEach(to => {
          if (parseInt(from) < to) {
            const start = positions[from];
            const end   = positions[to];
            const dx    = end.x - start.x;
            const dy    = end.y - start.y;
            const dist  = Math.hypot(dx, dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;

            const line = document.createElement('div');
            line.className = 'line';
            line.style.left = start.x + 'px';
            line.style.top  = start.y + 'px';
            line.style.width = dist + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            board.appendChild(line);
          }
        });
      });

      // é»
      Object.entries(positions).forEach(([id, pos]) => {
        const n = document.createElement('div');
        n.className = 'node empty';
        n.dataset.id = id;
        n.style.left = (pos.x - 28) + 'px';
        n.style.top  = (pos.y - 28) + 'px';

        const inner = document.createElement('span');
        const p = pieces[id];
        if (p === 'R') {
          n.classList.add('red');
          inner.textContent = 'R';
        } else if (p === 'B') {
          n.classList.add('blue');
          inner.textContent = 'B';
        } else {
          inner.textContent = '';
        }
        n.appendChild(inner);

        n.addEventListener('click', () => onNodeClick(parseInt(id)));
        board.appendChild(n);
      });
    }

    function onNodeClick(id) {
      if (!currentPlayer) {
        setMessage('è«‹å…ˆæ€ã€Œç´…æ–¹å…ˆæ‰‹ã€æˆ–ã€Œè—æ–¹å…ˆæ‰‹ã€ã€‚');
        return;
      }

      const piece = pieces[id];

      if (selectedNode === null) {
        if (piece === currentPlayer) {
          selectedNode = id;
          document.querySelector(`[data-id="${id}"]`).classList.add('selected');
          setMessage(`å·²é¸ ${currentPlayer==='R'?'ç´…æ£‹':'è—æ£‹'}ï¼Œå†é»ç›¸é„°ä½ç½®ã€‚`);
        } else {
          setMessage('åªèƒ½é¸è‡ªå·±é¡è‰²çš„æ£‹ã€‚');
        }
        return;
      }

      const from = selectedNode;
      const to   = id;

      if (!edges[from].includes(to)) {
        setMessage('åªå¯ä»¥ç§»åˆ°ç›¸é„°ã€ç”±ç·šé€£æ¥çš„æ ¼ã€‚');
        return;
      }

      if (pieces[to] === currentPlayer) {
        // æ”¹é¸
        document.querySelector(`[data-id="${from}"]`).classList.remove('selected');
        selectedNode = to;
        document.querySelector(`[data-id="${to}"]`).classList.add('selected');
        setMessage('æ”¹ç‚ºé¸é€™ä¸€æ ¼ã€‚');
        return;
      }

      // åˆæ³•ç§»å‹•ï¼ˆç©ºä½æˆ–é£Ÿå°æ–¹ï¼‰
      pieces[to] = currentPlayer;
      pieces[from] = null;
      document.querySelector(`[data-id="${from}"]`).classList.remove('selected');
      selectedNode = null;

      checkGameEnd();
      renderBoard();
      if (!isSeriesOver() && stillBothAlive()) {
        currentPlayer = currentPlayer === 'R' ? 'B' : 'R';
        updateUI();
        setMessage(`${currentPlayer==='R'?'ç´…æ£‹':'è—æ£‹'}å›åˆï¼šé¸æ£‹ç§»å‹•ã€‚`);
      }
    }

    function stillBothAlive() {
      const redAlive  = Object.values(pieces).includes('R');
      const blueAlive = Object.values(pieces).includes('B');
      return redAlive && blueAlive;
    }

    function checkGameEnd() {
      const redAlive  = Object.values(pieces).includes('R');
      const blueAlive = Object.values(pieces).includes('B');
      if (redAlive && blueAlive) return;

      const winner = redAlive ? 'R' : 'B';
      if (winner === 'R') redScore++; else blueScore++;
      redScoreEl.textContent  = redScore;
      blueScoreEl.textContent = blueScore;

      const txt = `${winner==='R'?'ç´…æ£‹':'è—æ£‹'}é£Ÿæ‰å°æ‰‹ï¼Œè´ç¬¬ ${gameNumber} ç›¤ï¼`;
      message.classList.add('win-msg');
      setMessage(txt);

      if (isSeriesOver()) {
        setMessage(txt + ` ç³»åˆ— 3 å‹å®Œæˆï¼`);
        return;
      }

      setTimeout(() => {
        message.classList.remove('win-msg');
        gameNumber++;
        currentGameEl.textContent = gameNumber;
        initBoard();
      }, 2000);
    }

    function isSeriesOver() {
      return redScore >= 3 || blueScore >= 3;
    }

    function updateUI() {
      redScoreEl.textContent  = redScore;
      blueScoreEl.textContent = blueScore;
      currentGameEl.textContent = gameNumber;
      currentTurnEl.textContent = currentPlayer
        ? (currentPlayer === 'R' ? 'ç´…æ–¹' : 'è—æ–¹')
        : 'æœªé–‹å§‹';
    }

    function setMessage(t) {
      message.textContent = t;
    }

    // æŒ‰éˆ•äº‹ä»¶
    document.getElementById('resetBtn').addEventListener('click', () => {
      initBoard();
    });

    document.getElementById('newSeriesBtn').addEventListener('click', () => {
      redScore = 0;
      blueScore = 0;
      gameNumber = 1;
      initBoard();
    });

    document.getElementById('startRedBtn').addEventListener('click', () => {
      currentPlayer = 'R';
      updateUI();
      setMessage('ç´…æ–¹å…ˆæ‰‹ï¼šé»é¸ç´…è‰²æ£‹ï¼Œå†é»ç›¸é„°æ ¼ã€‚');
    });

    document.getElementById('startBlueBtn').addEventListener('click', () => {
      currentPlayer = 'B';
      updateUI();
      setMessage('è—æ–¹å…ˆæ‰‹ï¼šé»é¸è—è‰²æ£‹ï¼Œå†é»ç›¸é„°æ ¼ã€‚');
    });

    document.addEventListener('DOMContentLoaded', initBoard);
  </script>
</body>
</html>
